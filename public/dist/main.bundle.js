(()=>{"use strict";function e(e,t,n="smooth"){var a=t*window.innerHeight,o=e*window.innerWidth;const i=a.toFixed(),s=o.toFixed(),r=function(){window.pageYOffset.toFixed()===i&&window.pageXOffset.toFixed()===s&&window.removeEventListener("scroll",r)};window.addEventListener("scroll",r),r(),window.scroll({top:t*window.innerHeight,left:e*window.innerWidth,behavior:n})}var t=document.getElementsByClassName("col"),n={x:0,y:0};function a(e=null){for(var n=0;n<t.length;n++)t[n].classList.remove("slide");null!=e&&setTimeout(e(),2e3)}function o(e=null){for(var n=document.documentElement.style.getPropertyValue("--farLeft"),o=document.documentElement.style.getPropertyValue("--farTop"),i=0;i<t.length;i++)t[i].style.left=n,t[i].style.top=o;null!=e?a(e):a()}function i(e,a,i=null){n.x=e,n.y=a;var s=document.documentElement.style.getPropertyValue("--farLeft"),r=-100*e;r=r.toString()+"vw",""==s&&(s="0"),document.documentElement.style.setProperty("--cur",s),document.documentElement.style.setProperty("--farLeft",r);var c=document.documentElement.style.getPropertyValue("--farTop"),l=-100*a;l=l.toString()+"vh",""==c&&(c="0"),document.documentElement.style.setProperty("--tcur",c),document.documentElement.style.setProperty("--farTop",l),function(){for(var e=0;e<t.length;e++)t[e].classList.add("slide")}(),null==i?t[0].addEventListener("animationend",(function(){o()}),!1):t[0].addEventListener("animationend",(function(){o(i)}),!1)}const s={};function r(){s.canvas.style.transform=`translate(${s.offsetX}px, ${s.offsetY}px)`,s.updateToolInteractor()}s.validateForm=function(){const e=document.getElementById("email"),t=document.getElementById("password"),n=document.getElementById("confirm-password");e.classList.remove("wrong"),t.classList.remove("wrong"),n.classList.remove("wrong");const a=e.value.trim(),o=t.value,i=n.value;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))return e.classList.add("wrong"),alert("Invalid email"),!1;if(o!==i)return t.classList.add("wrong"),n.classList.add("wrong"),alert("Passwords do not match!"),!1;const s=document.getElementById("username"),r=s.value.trim();return s.value=r,t.value=o,fetch("/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({display_name:r,email:a,password:o})}).then((e=>{console.log(e),e.redirected?(alert("Registration successful!"),window.location.href=e.url):alert("Registration failed. Please try again.")})).catch((e=>{console.error("Error:",e),alert("An error occurred while processing your request. Please try again later.")})),!0},s.setCookie=function(e,t,n){const a=document.cookie.split(";");for(let e=0;e<a.length;e++){const t=a[e],n=t.indexOf("="),o=n>-1?t.substr(0,n):t;document.cookie=`${o}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`}const o=`${e}=${t}; expires=${new Date(n).toUTCString()}; path=/`;document.cookie=o},s.init=function(){s.socket=io({autoConnect:!0}).connect(),e(0,0),s.sideBar=document.getElementById("sideBar"),s.appBody=document.getElementById("appBody"),document.getElementById("signUpbtn").onclick=s.validateForm,document.getElementById("signinbtn").onclick=function(e){e.preventDefault();const t=document.getElementById("emailSignin").value.trim(),n=document.getElementById("passwordSignin").value;fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:n}),timeout:5}).then((e=>{e.redirected?window.location.href=e.url:alert("Login failed. Please check your email and password.")})).catch((e=>{console.error("Error:",e),alert("An error occurred while processing your request. Please try again later.")}))},document.getElementById("signinHeader").onclick=function(){i(1,0)},document.getElementById("signupbtn").onclick=function(){i(1,1)},document.getElementById("twitchsignbtn").onclick=function(){window.location.href="/auth/twitch"},document.getElementById("googlesignbtn").onclick=function(){window.location.href="/auth/google"},e(0,0);const t=window.location.search;"true"===new URLSearchParams(t).get("auth")&&(s.socket.app={},s.socket.on("connect",(()=>{s.socket.emit("userInfo",(e=>{if(console.log(e),e){const t=document.getElementById("headerRightButtons");t.innerHTML="";const n=document.createElement("div");n.classList.add("inputWrapper"),n.appendChild(document.createTextNode("Welcome! "+e.display_name)),t.appendChild(n)}else 0==e&&(window.location.ref="/")}))}))),u();const n=document.getElementById("createTemplateform");document.getElementById("newTemplate").onclick=function(){if(s.socket.app.newTemplateLock)alert("Please finish creating first!");else{var e=document.createElement("div");e.classList.add("toggle");var t=document.createElement("div");t.innerHTML="New!",t.classList.add("item"),e.append(t),s.sideBar.children[1].append(e),s.socket.app.newTemplateLock=!0,n.style.display="block"}};const a=document.getElementById("height"),o=document.getElementById("width"),c=document.getElementById("unit"),l=document.getElementById("maxValue");function d(){"metric"===c.value?(a.setAttribute("max","38.1"),o.setAttribute("max","38.1"),l.value="38.1"):(a.setAttribute("max","15"),o.setAttribute("max","15"),l.value="15")}d(),c.addEventListener("change",d),n.addEventListener("submit",(function(e){e.preventDefault(),document.getElementById("name").value;var t=parseFloat(a.value),n=parseFloat(o.value);const r=c.value,d=(parseFloat(l.value),document.createElement("canvas")),u=300;s.u="metric"===r?2*Math.min(n,t):4*Math.min(n,t),"metric"===r?(n=Math.round(n*u*100/2.54)/100/2,t=Math.round(t*u*100/2.54)/100/2):(n=Math.round(n*u*100)/100/2,t=Math.round(t*u*100)/100/2),d.width=n,d.height=t,i(3,0),d.getContext("2d"),d.id="creatorCanvas",d.getContext("2d"),document.getElementById("creator").append(d),function(){s.canvas=document.getElementById("creatorCanvas"),s.ctx=s.canvas.getContext("2d"),s.ctx.clearRect(0,0,s.canvas.width,s.canvas.height),s.drawGrid(s.canvas,s.canvas.width/s.u,"lightgrey");for(const e of s.instances)s.ctx.drawImage(e.img,e.x,e.y,e.width,e.height)}(),s.socket.emit("user:sessionUpdate","designing",(e=>{s.setCookie(e)})),s.initCanvas()}));const m=document.getElementById("creatorContainer");s.addClickListenersToButtons(m),document.getElementById("drag-bar").addEventListener("mousedown",s.onMouseDown),window.addEventListener("mouseup",s.onMouseUp),window.addEventListener("mousemove",s.onMouseMove),document.getElementById("resetCanvas").addEventListener("click",(()=>{s.offsetX=0,s.offsetY=0,r()})),s.imgLibrary={},s.canvasContainer=document.getElementById("creator"),s.canvasContainer.addEventListener("mousedown",(e=>{0===e.button&&e.target===s.canvas&&(s.isDragging=!0,s.startX=e.clientX,s.startY=e.clientY)})),window.addEventListener("resize",u);const g=document.querySelector(".mainBody"),f=g.querySelector(".imageContainer"),h=g.querySelector("#loadMoreBtn");let p=[];function y(){s.socket.emit("getRandomImages",p)}s.socket.on("randomImages",(e=>{e.forEach((e=>{if(!p.includes(e.ImageURL)){const t=document.createElement("img"),n=document.createElement("div");t.src=e.ImageURL,n.appendChild(t),n.dataset.imageContainer="",f.appendChild(n),p.push(e.ImageURL)}}))})),h.addEventListener("click",y),y(),function(){const e=document.querySelectorAll(".imageContainer"),t=document.createElement("article");t.id="imgCtrl",t.innerHTML='\n    <button id="subctrl">-</button>\n    <input type="number" id="display" value="0" />\n    <button id="addctrl">+</button>\n  ',e.forEach((e=>{e.qty=0,e.addEventListener("click",(e=>function(e,n){const a=e.target.closest("[data-image-container]");a&&(document.querySelectorAll("[data-image-container]").forEach((e=>{e.classList.remove("selected")})),a.classList.add("selected"),a.appendChild(t),t.querySelector("#display").value=a.qty||0)}(e)))})),t.querySelector("#subctrl").addEventListener("click",(function(){const e=t.parentElement;let n=parseInt(t.querySelector("#display").value);n>0&&(e.qty=n-1,t.querySelector("#display").value=e.qty)})),t.querySelector("#addctrl").addEventListener("click",(function(){const e=t.parentElement;let n=parseInt(t.querySelector("#display").value);e.qty=n+1,t.querySelector("#display").value=e.qty}))}()},s.drawGrid=function(e,t,n){const a=e.getContext("2d");a.strokeStyle=n,a.lineWidth=1;const o=Math.ceil(e.height/t),i=Math.ceil(e.width/t);for(let n=1;n<i;n++){const o=n*t;a.beginPath(),a.moveTo(o,0),a.lineTo(o,e.height),a.stroke()}for(let n=1;n<o;n++){const o=n*t;a.beginPath(),a.moveTo(0,o),a.lineTo(e.width,o),a.stroke()}},s.addClickListenersToButtons=function(e){const t=e.querySelectorAll(".creator-button");var n=0;t.forEach((e=>{e.addEventListener("click",(()=>{!function(e){const t=document.getElementById(e),n=t.classList.contains("open");var a=document.getElementsByClassName("panel");for(let e=0;e<a.length;e+=1)a[e].classList.remove("open");n?t.classList.remove("open"):t.classList.add("open")}(e.getAttribute("data-panel-id"))})),e.parentElement.id=e.innerHTML.replace(/\s/g,"_");const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),a=(e.setAttribute("data-panel-id",t),e.parentElement.children[1]);a.id=t,a.style.transform="translateX(-400px)",a.classList.add("panel");const o=["rgb(0, 0, 255)","rgb(0, 255, 0)","rgb(255, 255, 0)","rgb(255, 165, 0)","rgb(255, 0, 0)"],i=o[n%o.length];e.style.background=i,e.style.top=7*n+"vh",e.style.color=["rgb(200, 200, 200)","rgb(150, 150, 150)","rgb(100, 100, 100)","rgb(75, 75, 75)","rgb(50, 50, 50)"][n%o.length],n+=1}))},s.isDragging=!1,s.onMouseDown=function(e){s.isDragging=!0},s.onMouseUp=function(){s.isDragging=!1},s.startX=0,s.startY=0,s.offsetX=0,s.offsetY=0,window.addEventListener("mousemove",(e=>{if(s.isDragging){const t=e.clientX-s.startX,n=e.clientY-s.startY;s.offsetX+=t,s.offsetY+=n,s.startX=e.clientX,s.startY=e.clientY,r()}}));let c=10,l=68,d=!0;function u(){window.innerWidth<1e3?(c=30,l=55.75,d=!1,s.sideBar.style.flexBasis="calc(20% - 5px)",s.appBody.style.flexBasis="calc(55.75% - 5px)"):(c=10,l=68,d=!0,s.sideBar.style.flexBasis="calc(20% - 5px)",s.appBody.style.flexBasis="calc(80% - 5px)")}s.onMouseMove=function(e){if(s.isDragging)if(d){const t=e.clientX/window.innerWidth*100,n=Math.min(Math.max(t,c),l);s.sideBar.style.flexBasis=`calc(${n}% - 5px)`,s.appBody.style.flexBasis=`calc(${100-n}% - 5px)`}else{const t=e.clientY/window.innerHeight*100,n=Math.min(Math.max(t,c),l);s.sideBar.style.height=`calc(${n}% - 5px)`,s.appBody.style.height=`calc(${100-n}% - 5px)`}};let m=0;s.updateImageContainer=function(){const e=++m,t=document.getElementById("imglibimgcontainer");if(!t)return void console.error('Container with id "imglibimgcontainer" not found');for(;t.firstChild;)t.removeChild(t.firstChild);let n=Promise.resolve();s.possibilities.forEach((a=>{const o=`http://localhost/${a.ImageURL}`;n=n.then((()=>{return n=o,new Promise(((a,o)=>{if(e!==m)return void o("Image loading cancelled due to update");const i=document.createElement("img");i.onload=a,i.onerror=o,i.src=n,t.appendChild(i)}));var n})).catch((e=>{"Image loading cancelled due to update"!==e&&console.error("Error loading image:",e)}))})),n.then((()=>{s.canvas=document.getElementById("creatorCanvas"),s.ctx=s.canvas.getContext("2d"),s.initCanvas(),s.makeImagesDraggable()}))},s.instances=[],s.initCanvas=function(){this.canvas.addEventListener("drop",this.handleDrop.bind(this)),this.canvas.addEventListener("dragover",(function(e){e.preventDefault()})),s.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),s.canvas.parentNode.addEventListener("mousedown",(e=>{"imageToolInteractor"===e.target.id&&(s.isResizing=!0,s.originalX=e.clientX,s.originalY=e.clientY,s.originalWidth=s.divToScale.offsetWidth,s.originalHeight=s.divToScale.offsetHeight)}))},s.handleDrop=function(e){e.preventDefault();const t=e.dataTransfer.getData("text"),n=parseInt(e.dataTransfer.getData("width"),10),a=parseInt(e.dataTransfer.getData("height"),10),o=parseInt(e.dataTransfer.getData("offsetX"),10),i=parseInt(e.dataTransfer.getData("offsetY"),10),s=new Image;s.src=t,s.onload=()=>{this.ctx.drawImage(s,e.offsetX-o,e.offsetY-i,n,a),this.instances.push({img:s,x:e.offsetX-o,y:e.offsetY-i,width:n,height:a,scale:1,rotation:0})}},s.makeImagesDraggable=function(){for(var e=document.getElementById("imglibimgcontainer").children,t=0;t<e.length;t++){let n=e[t];n.draggable=!0,n.addEventListener("dragstart",(function(e){const t=n.getBoundingClientRect(),a=e.clientX-t.left,o=e.clientY-t.top;e.dataTransfer.setData("text",n.src),e.dataTransfer.setData("width",n.offsetWidth),e.dataTransfer.setData("height",n.offsetHeight),e.dataTransfer.setData("offsetX",a),e.dataTransfer.setData("offsetY",o)}))}},s.handleMouseDown=function(e){const t=this.canvas,n=t.getBoundingClientRect().left,a=t.getBoundingClientRect().top,o=e.clientX-n,i=e.clientY-a;for(const e of this.instances){const{x:t,y:n,width:a,height:r}=e;if(o>=t&&o<=t+a&&i>=n&&i<=n+r){this.selectedImage=e,this.dragOffsetX=o-t,this.dragOffsetY=i-n,s.updateToolInteractor();break}}},s.divToScale=document.getElementById("myDiv"),s.resizeHandle=document.getElementById("top-left"),s.isResizing=!1,s.originalX=0,s.originalY=0,s.originalWidth=0,s.originalHeight=0,document.addEventListener("mousemove",(e=>{if(s.isResizing){const t=e.clientX-s.originalX,n=e.clientY-s.originalY;s.divToScale.style.width=s.originalWidth+t+"px",s.divToScale.style.height=s.originalHeight+n+"px"}})),document.addEventListener("mouseup",(()=>{s.isResizing=!1})),window.onload=function(){s.init(),document.querySelectorAll(".mainBody").forEach((e=>{e.addEventListener("dragover",(e=>{e.preventDefault()})),e.addEventListener("drop",(e=>{e.preventDefault();const t=e.dataTransfer.files,n=[];for(let e=0;e<t.length;e++){const a=t[e],o=new FileReader;o.onload=e=>{n.push({name:a.name,type:a.type,data:e.target.result}),n.length===t.length&&(console.log(s.socket),console.log(n),s.socket.emit("uploadImages",n))},o.readAsDataURL(a)}}))}))}})();